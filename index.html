<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PHASE 15 | LBS Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #f8fafc; }
        .glass-card { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; }
        .input-dark { background: #1e293b; border: 1px solid #334155; color: white; border-radius: 8px; padding: 12px; width: 100%; }
        .accent-gradient { background: linear-gradient(90deg, #10b981 0%, #3b82f6 100%); }
        .tab-active { border-bottom: 4px solid #10b981; color: #10b981; }
    </style>
</head>
<body class="min-h-screen pb-24">

    <header class="p-6">
        <h1 class="text-3xl font-black tracking-tighter italic text-emerald-500 uppercase">PHASE 15</h1>
        <p class="text-[10px] text-slate-500 font-bold uppercase tracking-widest">Tracking in LBS | Science-Backed</p>
    </header>

    <nav class="flex px-6 space-x-6 mb-6 border-b border-slate-800">
        <button onclick="switchTab('lift')" id="t-lift" class="pb-2 font-bold text-xs tab-active uppercase">Workout</button>
        <button onclick="switchTab('history')" id="t-history" class="pb-2 font-bold text-xs text-slate-500 uppercase">History</button>
        <button onclick="switchTab('stats')" id="t-stats" class="pb-2 font-bold text-xs text-slate-500 uppercase">Metrics</button>
    </nav>

    <main class="px-4">
        <div id="view-lift" class="space-y-4">
            <div class="flex gap-2">
                <select id="workout-select" class="input-dark font-bold text-emerald-400" onchange="renderWorkout()">
                    <option value="">Load Split...</option>
                    <option value="upperA">Upper A</option>
                    <option value="lowerA">Lower A</option>
                </select>
                <button onclick="addNewExercise()" class="bg-slate-700 px-4 rounded-lg font-black text-xl">+</button>
            </div>
            
            <div id="exercise-container" class="space-y-3"></div>
            
            <button onclick="submitData('Lift')" class="w-full accent-gradient py-4 rounded-xl font-black uppercase shadow-lg shadow-emerald-900/20">Sync to Sheets</button>
        </div>

        <div id="view-history" class="hidden space-y-3">
            <button onclick="fetchHistory()" class="w-full bg-slate-800 py-2 rounded font-bold text-xs uppercase mb-2">Refresh Logs</button>
            <div id="history-list" class="space-y-2">
                <p class="text-slate-500 text-center text-sm italic">Click refresh to load logs...</p>
            </div>
        </div>

        <div id="view-stats" class="hidden space-y-4">
            <div class="glass-card p-6">
                <input type="number" id="body-wt" placeholder="Weight (lbs)" class="input-dark mb-3">
                <input type="number" id="body-bf" placeholder="Body Fat %" class="input-dark mb-4">
                <button onclick="submitData('Stats')" class="w-full bg-slate-700 py-4 rounded-xl font-black uppercase">Update Weight</button>
            </div>
        </div>
    </main>

    <script>
        const scriptURL = 'https://script.google.com/macros/s/AKfycbxOZRymFSVmw6gU6G8I6coN_-hlBF_LTnKND4VO3n_-dVO_qptWTLj9rHX5IYZJw0kM/exec'; 
        
        const protocols = {
    upperA: [
        {n: "Bench Press", r: "3 x 6-8", desc: "Heavy Strength"},
        {n: "Barbell Row", r: "3 x 8-10", desc: "Back Power"},
        {n: "DB Overhead Press", r: "3 x 10-12", desc: "Shoulders"},
        {n: "Lat Pulldown", r: "3 x 12", desc: "Width"},
        {n: "Tricep Pushdowns", r: "3 x 15", desc: "Arms"}
    ],
    lowerA: [
        {n: "Back Squat", r: "3 x 6-8", desc: "Quad Focus"},
        {n: "Walking Lunges", r: "3 x 12/leg", desc: "Glute/Stability"},
        {n: "Leg Extensions", r: "3 x 15", desc: "Isolation"},
        {n: "Seated Calf Raise", r: "4 x 15", desc: "Running Prep"},
        {n: "Plank", r: "3 x 60s", desc: "Core"}
    ],
    upperB: [
        {n: "Pull Ups/Assisted", r: "3 x AMRAP", desc: "Back Focus"},
        {n: "Incline DB Press", r: "3 x 10-12", desc: "Upper Chest"},
        {n: "Seated Cable Row", r: "3 x 12", desc: "Thickness"},
        {n: "Lateral Raises", r: "3 x 15-20", desc: "Metabolic Stress"},
        {n: "Bicep Curls", r: "3 x 12", desc: "Arms"}
    ],
    lowerB: [
        {n: "Deadlift (Hex/Conv)", r: "3 x 5", desc: "Posterior Chain"},
        {n: "Romanian Deadlift", r: "3 x 10-12", desc: "Hamstrings"},
        {n: "Leg Curls", r: "3 x 12-15", desc: "Hams Isolation"},
        {n: "Standing Calf Raise", r: "4 x 12", desc: "Explosive"},
        {n: "Hanging Leg Raises", r: "3 x 15", desc: "Lower Abs"}
    ]
};

        function switchTab(tab) {
            ['lift', 'history', 'stats'].forEach(t => {
                document.getElementById('view-'+t).classList.add('hidden');
                document.getElementById('t-'+t).classList.replace('text-emerald-400', 'text-slate-500');
                document.getElementById('t-'+t).classList.remove('tab-active');
            });
            document.getElementById('view-'+tab).classList.remove('hidden');
            document.getElementById('t-'+tab).classList.replace('text-slate-500', 'text-emerald-400');
            document.getElementById('t-'+tab).classList.add('tab-active');
        }

        function renderWorkout() {
            const protocol = protocols[document.getElementById('workout-select').value];
            const container = document.getElementById('exercise-container');
            container.innerHTML = '';
            if(protocol) protocol.forEach(ex => createExerciseRow(ex.n, ex.r));
        }

        function createExerciseRow(name = "New Exercise", target = "8-12") {
            const container = document.getElementById('exercise-container');
            const div = document.createElement('div');
            div.className = "glass-card p-4 exercise-row";
            div.innerHTML = `
                <input type="text" value="${name}" class="bg-transparent font-black uppercase text-emerald-500 text-xs mb-2 w-full focus:outline-none">
                <div class="grid grid-cols-2 gap-2">
                    <input type="number" placeholder="LBS" class="input-dark weight-input">
                    <input type="number" placeholder="REPS" class="input-dark rep-input">
                </div>
            `;
            container.appendChild(div);
        }

        function addNewExercise() { createExerciseRow(); }

        async function fetchHistory() {
            const list = document.getElementById('history-list');
            list.innerHTML = "Fetching...";
            try {
                const response = await fetch(`${scriptURL}?read=true`);
                const logs = await response.json();
                list.innerHTML = logs.map(row => `
                    <div class="glass-card p-3 text-[10px]">
                        <span class="text-emerald-500 font-bold">${new Date(row[0]).toLocaleDateString()}</span> | 
                        <span class="text-slate-300 font-bold uppercase">${row[1]}</span>
                        <p class="text-slate-400 mt-1">${row[2]}</p>
                    </div>
                `).join('');
            } catch (e) { list.innerHTML = "Error loading history."; }
        }

        async function submitData(type) {
            let content = "";
            if (type === 'Lift') {
                const rows = document.querySelectorAll('.exercise-row');
                content = Array.from(rows).map(row => {
                    const n = row.querySelector('input[type="text"]').value;
                    const w = row.querySelector('.weight-input').value;
                    const r = row.querySelector('.rep-input').value;
                    return `${n}: ${w}lbs x ${r}`;
                }).join(' | ');
            } else {
                content = `Weight: ${document.getElementById('body-wt').value}lbs | BF: ${document.getElementById('body-bf').value}%`;
            }

            // Sync Logic
            await fetch(scriptURL, {
                method: 'POST',
                mode: 'no-cors',
                body: JSON.stringify({ type: type, content: content })
            });
            alert("Data Synced.");
        }
    </script>
</body>
</html>