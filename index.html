<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PHASE 15 | RECOMP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: 'Inter', sans-serif; background: #020617; color: white; margin: 0; padding: 0; }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }
        .input-box { background: #1e293b; border: 1px solid #334155; color: white; border-radius: 8px; padding: 10px; width: 100%; text-align: center; font-weight: bold; }
        .tab-btn { flex: 1; padding: 12px; font-size: 10px; font-weight: 900; text-transform: uppercase; letter-spacing: 1px; color: #64748b; border-bottom: 2px solid transparent; transition: 0.3s; }
        .tab-active { color: #3b82f6; border-bottom: 2px solid #3b82f6; background: rgba(59, 130, 246, 0.1); }
        .btn-blue { background: #2563eb; color: white; font-weight: 900; text-transform: uppercase; padding: 15px; border-radius: 12px; width: 100%; border: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzdnhWN3Hq5CySfu2GSse8FYv2_OksqhqQgSvI57IbLseXw4t7r8JoHbuucegB-489X/exec';
        const { createElement: h, useState, useEffect } = React;

        function App() {
            const [tab, setTab] = useState('workout');
            const [workouts, setWorkouts] = useState([]);
            const [metrics, setMetrics] = useState([]);
            const [activeWkt, setActiveWkt] = useState(null);
            const [exData, setExData] = useState([]);
            const [status, setStatus] = useState('');

            // Data Mapping
            const templates = {
                'Push': ['Bench Press', 'Overhead Press', 'Lateral Raise'],
                'Pull': ['Deadlift', 'Pull Up', 'Bicep Curl'],
                'Lower Quad': ['Back Squat', 'Leg Press', 'Calf Raise'],
                'Lower Ham': ['RDL', 'Leg Curl', 'Lunges'],
                'Cardio': ['Easy Run (30m)', 'Long Run (60m)']
            };

            // Persistence
            useEffect(() => {
                const savedW = localStorage.getItem('p15_w');
                const savedM = localStorage.getItem('p15_m');
                if (savedW) setWorkouts(JSON.parse(savedW));
                if (savedM) setMetrics(JSON.parse(savedM));
            }, []);

            useEffect(() => {
                localStorage.setItem('p15_w', JSON.stringify(workouts));
                localStorage.setItem('p15_m', JSON.stringify(metrics));
            }, [workouts, metrics]);

            const start = (t) => {
                setActiveWkt(t);
                setExData(templates[t].map(name => ({ name, w: '', r: '' })));
            };

            const save = () => {
                const text = exData.map(e => `${e.name}: ${e.w} lbs x ${e.r} reps`).join('\n');
                const log = { type: activeWkt, date: new Date().toLocaleDateString(), content: text };
                setWorkouts([log, ...workouts]);
                setActiveWkt(null);
                setTab('history');
                
                if(SCRIPT_URL.includes('http')) {
                    setStatus('Syncing...');
                    fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify({dataType:'lift', ...log}) })
                    .then(() => setStatus('âœ“ Cloud Saved')).catch(() => setStatus('Local Only'));
                }
            };

            const addMetric = () => {
                const val = document.getElementById('w-val').value;
                if(!val) return;
                const m = { type: 'weight', value: val, date: new Date().toLocaleDateString() };
                setMetrics([m, ...metrics]);
                document.getElementById('w-val').value = '';
                setTab('history');
            };

            return h('div', { className: 'max-w-md mx-auto p-4' },
                // Header
                h('div', { className: 'text-center py-6' },
                    h('h1', { className: 'text-3xl font-black italic text-blue-500' }, 'PHASE 15'),
                    h('p', { className: 'text-[10px] text-slate-500 font-bold uppercase' }, 'March 7 Race Countdown')
                ),

                // Nav
                h('div', { className: 'flex mb-6 glass rounded-xl overflow-hidden' },
                    ['workout', 'history', 'metrics'].map(t => 
                        h('button', { key: t, onClick: () => setTab(t), className: `tab-btn ${tab === t ? 'tab-active' : ''}` }, t)
                    )
                ),

                // WORKOUT VIEW
                tab === 'workout' && (
                    !activeWkt ? h('div', { className: 'space-y-3' },
                        Object.keys(templates).map(t => h('button', { key: t, onClick: () => start(t), className: 'glass p-5 w-full text-left rounded-2xl font-bold flex justify-between' }, t, h('i', {className:'fas fa-plus text-blue-500'})))
                    ) : h('div', { className: 'space-y-4' },
                        h('h2', { className: 'text-xl font-bold text-blue-400 px-2' }, activeWkt),
                        exData.map((ex, i) => h('div', { key: i, className: 'glass p-4 rounded-2xl' },
                            h('p', { className: 'text-xs font-bold text-slate-400 mb-2' }, ex.name),
                            h('div', { className: 'flex gap-2' },
                                h('input', { placeholder: 'LBS', type: 'number', className: 'input-box', value: ex.w, onChange: (e) => {
                                    const next = [...exData]; next[i].w = e.target.value; setExData(next);
                                }}),
                                h('input', { placeholder: 'REPS', type: 'number', className: 'input-box', value: ex.r, onChange: (e) => {
                                    const next = [...exData]; next[i].r = e.target.value; setExData(next);
                                }})
                            )
                        )),
                        h('button', { onClick: save, className: 'btn-blue mt-4' }, 'Complete Session')
                    )
                ),

                // HISTORY VIEW
                tab === 'history' && h('div', { className: 'space-y-4' },
                    metrics.length > 0 && h('div', { className: 'glass p-4 rounded-2xl border-l-4 border-emerald-500 mb-6' },
                        h('p', { className: 'text-[10px] font-bold text-slate-500 uppercase' }, 'Latest Weight'),
                        h('p', { className: 'text-2xl font-black' }, metrics[0].value, ' lbs')
                    ),
                    workouts.map((w, i) => h('div', { key: i, className: 'glass p-5 rounded-2xl border-l-4 border-blue-600' },
                        h('div', { className: 'flex justify-between mb-2' },
                            h('span', { className: 'font-black text-blue-400 text-sm uppercase' }, w.type),
                            h('span', { className: 'text-[10px] text-slate-500' }, w.date)
                        ),
                        h('pre', { className: 'text-xs text-slate-300 font-sans' }, w.content)
                    ))
                ),

                // METRICS VIEW
                tab === 'metrics' && h('div', { className: 'glass p-6 rounded-3xl text-center' },
                    h('p', { className: 'text-xs font-bold text-slate-500 uppercase mb-4' }, 'Update Current Weight'),
                    h('input', { id: 'w-val', type: 'number', placeholder: '0.0', className: 'input-box text-2xl mb-4 h-16' }),
                    h('button', { onClick: addMetric, className: 'btn-blue' }, 'Save Weight')
                ),

                status && h('div', { className: 'fixed bottom-4 left-1/2 -translate-x-1/2 bg-blue-600 px-6 py-2 rounded-full text-[10px] font-bold shadow-2xl' }, status)
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(h(App));
    </script>
</body>
</html>