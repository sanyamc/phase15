<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PHASE 15 | Protocol</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #f8fafc; }
        .glass-card { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; }
        .input-dark { background: #1e293b; border: 1px solid #334155; color: white; border-radius: 8px; padding: 12px; width: 100%; }
        .accent-gradient { background: linear-gradient(90deg, #10b981 0%, #3b82f6 100%); }
        .tab-active { border-bottom: 4px solid #10b981; color: #10b981; }
    </style>
</head>
<body class="min-h-screen pb-24">

    <header class="p-6 pt-10">
        <div class="flex justify-between items-end">
            <div>
                <h1 class="text-3xl font-black tracking-tighter uppercase italic text-emerald-500">Phase 15</h1>
                <p class="text-slate-400 text-xs font-bold tracking-widest uppercase">Scientist Coaching Portal</p>
            </div>
            <div class="text-right">
                <p class="text-2xl font-bold" id="days-count">--</p>
                <p class="text-[10px] text-slate-500 uppercase font-bold">Days to March Race</p>
            </div>
        </div>

        <div class="mt-8 glass-card p-4">
            <div class="flex justify-between text-[10px] mb-2 font-black text-slate-400 uppercase">
                <span>Current: 31% BF</span>
                <span>Goal: 15% BF</span>
            </div>
            <div class="h-3 bg-slate-800 rounded-full overflow-hidden">
                <div id="bf-bar" class="h-full accent-gradient transition-all duration-1000" style="width: 0%"></div>
            </div>
        </div>
    </header>

    <nav class="flex px-6 space-x-8 mb-6 border-b border-slate-800">
        <button onclick="switchTab('lift')" id="t-lift" class="pb-2 font-bold text-sm tab-active uppercase">Lifting</button>
        <button onclick="switchTab('run')" id="t-run" class="pb-2 font-bold text-sm text-slate-500 uppercase">Running</button>
        <button onclick="switchTab('stats')" id="t-stats" class="pb-2 font-bold text-sm text-slate-500 uppercase">Metrics</button>
    </nav>

    <main class="px-4">
        <div id="view-lift" class="space-y-4">
            <select id="workout-select" class="input-dark font-bold text-emerald-400" onchange="renderWorkout()">
                <option value="">Choose Morning Protocol...</option>
                <option value="upperA">Upper A (Push/Pull Strength)</option>
                <option value="lowerA">Lower A (Quads Focus)</option>
                <option value="upperB">Upper B (Hypertrophy)</option>
                <option value="lowerB">Lower B (Posterior/Hams)</option>
            </select>
            <div id="exercise-container" class="space-y-3"></div>
            <button onclick="submitData('Lift')" class="w-full accent-gradient py-4 rounded-xl font-black uppercase mt-4 shadow-lg shadow-emerald-900/20">Log Training</button>
        </div>

        <div id="view-run" class="hidden space-y-4">
            <div class="glass-card p-6 border-l-4 border-blue-500">
                <h3 class="font-black italic mb-4">AEROBIC ENGINE</h3>
                <div class="grid grid-cols-2 gap-4">
                    <input type="number" id="run-km" placeholder="KM" class="input-dark">
                    <input type="number" id="run-min" placeholder="MIN" class="input-dark">
                </div>
                <div class="mt-6">
                    <label class="text-xs font-bold text-slate-400 uppercase">Perceived Effort (RPE)</label>
                    <input type="range" id="run-rpe" min="1" max="10" value="5" class="w-full h-2 bg-slate-800 rounded-lg appearance-none cursor-pointer mt-2">
                    <div class="flex justify-between text-[10px] mt-1 text-slate-500 uppercase font-bold">
                        <span>Easy</span><span>Mid</span><span>Race Pace</span>
                    </div>
                </div>
                <button onclick="submitData('Run')" class="w-full bg-blue-600 py-4 rounded-xl font-black uppercase mt-6">Log Run</button>
            </div>
        </div>

        <div id="view-stats" class="hidden space-y-4">
            <div class="glass-card p-6">
                <h3 class="font-black italic mb-4 uppercase">Body Recomp</h3>
                <input type="number" id="body-wt" placeholder="Weight (kg)" class="input-dark mb-3" oninput="recalcMass()">
                <input type="number" id="body-bf" placeholder="Body Fat %" class="input-dark mb-4" oninput="recalcMass()">
                <div class="grid grid-cols-2 gap-2 text-center">
                    <div class="p-3 bg-slate-800 rounded-lg">
                        <p class="text-[10px] text-slate-500 font-bold uppercase">Lean Mass</p>
                        <p id="lean-kg" class="text-xl font-black text-emerald-400">--</p>
                    </div>
                    <div class="p-3 bg-slate-800 rounded-lg">
                        <p class="text-[10px] text-slate-500 font-bold uppercase">Fat Mass</p>
                        <p id="fat-kg" class="text-xl font-black text-red-400">--</p>
                    </div>
                </div>
                <button onclick="submitData('Stats')" class="w-full bg-slate-700 py-4 rounded-xl font-black uppercase mt-6">Update Metrics</button>
            </div>
        </div>
    </main>

    <script>
        // Logic & Data
        const raceDate = new Date('2026-03-22');
        document.getElementById('days-count').innerText = Math.ceil((raceDate - new Date()) / (1000 * 60 * 60 * 24));

        const protocols = {
            upperA: [{n: "Bench Press", r: "6-8"}, {n: "Barbell Row", r: "8-10"}, {n: "DB OHP", r: "8-10"}],
            lowerA: [{n: "Back Squat", r: "6-8"}, {n: "Leg Press", r: "10-12"}, {n: "Calf Raise", r: "15"}],
            upperB: [{n: "Pull Ups", r: "AMRAP"}, {n: "Incline DB", r: "10-12"}, {n: "Lat Raise", r: "15"}],
            lowerB: [{n: "Deadlift", r: "5"}, {n: "RDL", r: "10-12"}, {n: "Leg Curl", r: "12"}]
        };

        function switchTab(tab) {
            ['lift', 'run', 'stats'].forEach(t => {
                document.getElementById('view-'+t).classList.add('hidden');
                document.getElementById('t-'+t).classList.remove('tab-active', 'text-emerald-400');
                document.getElementById('t-'+t).classList.add('text-slate-500');
            });
            document.getElementById('view-'+tab).classList.remove('hidden');
            document.getElementById('t-'+tab).classList.add('tab-active', 'text-emerald-400');
        }

        function renderWorkout() {
            const protocol = protocols[document.getElementById('workout-select').value];
            const container = document.getElementById('exercise-container');
            container.innerHTML = protocol ? protocol.map((ex, i) => `
                <div class="glass-card p-4">
                    <p class="text-xs font-black uppercase text-slate-400 mb-2">${ex.n} <span class="text-emerald-500">[${ex.r}]</span></p>
                    <div class="grid grid-cols-2 gap-2">
                        <input type="number" id="w-${i}" placeholder="KG" class="input-dark text-center">
                        <input type="number" id="r-${i}" placeholder="REPS" class="input-dark text-center">
                    </div>
                </div>
            `).join('') : '';
        }

        function recalcMass() {
            const w = document.getElementById('body-wt').value;
            const bf = document.getElementById('body-bf').value;
            if(w && bf) {
                const lean = (w * (1 - bf/100)).toFixed(1);
                document.getElementById('lean-kg').innerText = lean + 'kg';
                document.getElementById('fat-kg').innerText = (w - lean).toFixed(1) + 'kg';
                document.getElementById('bf-bar').style.width = Math.max(0, Math.min(100, ((31 - bf) / (31 - 15)) * 100)) + '%';
            }
        }

        async function submitData(type) {
    const scriptURL = 'https://script.google.com/macros/s/AKfycbzTIJGc4UorHrsDMxAsSnOL9lpE_d1PpWioE-H78HGIqt1fO_qcRwJ9UgAQKX5ho0ZL/exec'; // PASTE YOUR URL HERE
    const submitBtn = event.target;
    const originalText = submitBtn.innerText;
    
    let content = "";
    
    // Logic to gather data based on the tab
    if (type === 'Lift') {
        const protocol = document.getElementById('workout-select').value;
        const rows = document.querySelectorAll('#exercise-container .glass-card');
        let results = [];
        rows.forEach((row, i) => {
            const w = document.getElementById(`w-${i}`).value;
            const r = document.getElementById(`r-${i}`).value;
            const name = row.querySelector('p').innerText.split('[')[0].trim();
            results.push(`${name}: ${w}kg x ${r}`);
        });
        content = `Protocol: ${protocol} | ${results.join(', ')}`;
    } else if (type === 'Run') {
        const km = document.getElementById('run-km').value;
        const min = document.getElementById('run-min').value;
        const rpe = document.getElementById('run-rpe').value;
        content = `Run: ${km}km in ${min}min | RPE: ${rpe}`;
    } else if (type === 'Stats') {
        const wt = document.getElementById('body-wt').value;
        const bf = document.getElementById('body-bf').value;
        content = `Weight: ${wt}kg | BF: ${bf}%`;
    }

    try {
        submitBtn.disabled = true;
        submitBtn.innerText = "SYNCING...";

        await fetch(scriptURL, {
            method: 'POST',
            mode: 'no-cors', // Essential for Google Apps Script
            cache: 'no-cache',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ type: type, content: content })
        });

        alert("Data Secured in Google Sheets.");
        submitBtn.innerText = "SUCCESS";
        setTimeout(() => { submitBtn.innerText = originalText; submitBtn.disabled = false; }, 2000);
    } catch (error) {
        console.error('Error!', error.message);
        alert("Sync Failed. Check Console.");
        submitBtn.disabled = false;
        submitBtn.innerText = originalText;
    }
}
    </script>
</body>
</html>